<!DOCTYPE html>
<html lang="en">
    <head>
        
            <title>MediaInfo JavaScript test page</title>
    
<script type="text/javascript">

        var MediaInfoModule,MI;
        function mediainfo_init(){/*needs to be called onload of body, at least before using mediainfo*/
        
            /*IE or FF or Chrome, loads different asm scripts?*/
            var MediaInfoJs = document.createElement('script');
            if ('WebAssembly' in window) {
              MediaInfoJs.src = "MediaInfoWasm.js";
            } else {
              MediaInfoJs.src = "MediaInfo.js";
            }
            document.body.appendChild(MediaInfoJs);

            // after script is loaded, initalize Mediainfo
            MediaInfoJs.onload = function () {
              MediaInfoModule = MediaInfoLib({'postRun': function() {
                    console.log('MediaInfo ready');
                    MI = new MediaInfoModule.MediaInfo();
                
                }});
            }
        }
              

        function analysis(_file,_callback){/*this function is called with file and callback as parameterto get mediainfo html output*/
               var processResult = function() {
                    MI.Option('Inform','HTML');
                    var infoHtml = (MI.Inform())
                    _callback(_file,infoHtml)
                    MI.Close();
                    //MI.delete();   
              }
            MI.Open(_file, processResult);            
      }
             
</script>
        
    </head>
    <body onload="mediainfo_init()">
        
        <p>
            <input type="file" id="input" />
        </p>
        <p><pre id="result"></pre></p>
    <script>
            //select file
        var input = document.getElementById('input');
            input.onchange = function() {
              if(input.files.length > 0) {
                analysis(input.files[0],function(ret){console.log(ret)})
              }
        }
    </script>
    </body>
</html>
