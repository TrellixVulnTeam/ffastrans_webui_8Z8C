<!--
  Copyright (c) 2006-2013, JGraph Ltd
  
  JSON data example for mxGraph. This example demonstrates using
  JSON to encode/decode parts of the graph model in mxCodec.
-->
<html>
<head>
	<title>JSON data example for mxGraph</title>

	<!-- Sets the basepath for the library if not in same directory -->
	<script type="text/javascript">
		mxBasePath = '../src';
	</script>

	<!-- Loads and initializes the library -->
	<script type="text/javascript" src="../src/js/mxClient.js"></script>

	<!-- Example code -->
	<script type="text/javascript">
		// Program starts here. Creates a sample graph in the
		// DOM node with the specified ID. This function is invoked
		// from the onLoad event handler of the document (see below).
		function main(container)
		{
			// Checks if the browser is supported
			if (!mxClient.isBrowserSupported())
			{
				// Displays an error message if the browser is not supported.
				mxUtils.error('Browser is not supported!', 200, false);
			}
			else
			{
                alert(getWorkflow());
				// Disables the built-in context menu
				mxEvent.disableContextMenu(container);
				
				// Creates the graph inside the given container
				var graph = new mxGraph(container);

				// Enables rubberband selection
				new mxRubberband(graph);
				
				// Gets the default parent for inserting new cells. This
				// is normally the first child of the root (ie. layer 0).
				var parent = graph.getDefaultParent();
								
				// Adds cells to the model in a single step
				graph.getModel().beginUpdate();
				try
				{
					var v1 = graph.insertVertex(parent, null, 'Hello,', 20, 20, 80, 30);
					v1.data = new CustomData('v1');
					var v2 = graph.insertVertex(parent, null, 'World!', 200, 150, 80, 30);
					v2.data = new CustomData('v2');
					var e1 = graph.insertEdge(parent, null, '', v1, v2);
				}
				finally
				{
					// Updates the display
					graph.getModel().endUpdate();
				}
			}
			
			// Adds an option to view the XML of the graph
			document.body.appendChild(mxUtils.button('View XML', function()
			{
				var encoder = new mxCodec();
				var node = encoder.encode(graph.getModel());
				mxUtils.popup(mxUtils.getXml(node), true);
			}));
		};
		
		function CustomData(value)
		{
			this.value = value;
		}
		
		var codec = new mxObjectCodec(new CustomData());

		codec.encode = function(enc, obj)
		{
			var node = enc.document.createElement('CustomData');
			mxUtils.setTextContent(node, JSON.stringify(obj));
		   
			return node;
		};
		
		codec.decode = function(dec, node, into)
		{
			var obj = JSON.parse(mxUtils.getTextContent(node));
			obj.constructor = CustomData;
			
			return obj;
		};

		mxCodecRegistry.register(codec);
        
        
        function getWorkflow(){ return {		"wf_id": 20181202163733,
		"general": {
			"abberation": false,
			"checksum": "B53D35C2E7062243062B16FD7466",
			"default_folder": true,
			"description": "",
			"folder": "",
			"last_mod_by": "churoll@DESKTOP-UIFQT86",
			"priority": "2 (normal)",
			"sleep": 30,
			"timeout_level": 3,
			"wf_name": "Merge_RGB_JPG",
			"wf_id": 20181202163733
		},
		"variable": {
			"start_procs": ["mon_folder 20181210-203327-968-5281b631b556"],
			"wf_size": 183.64565625
		},
		"maintainance": {
			"history_age": 5,
			"cleanup": "04:00",
			"delete_cachefile": false,
			"keep_all_workdir": true,
			"keep_failed_workdir": false,
			"run": 2345671
		},
		"special": {
			"abberation": false,
			"log_file": "C:\\Users\\churoll\\Downloads\\ffastrans\\Processors\\.cache\\wfs\\20181202163733\\logs",
			"log_jobs": true,
			"force_32bit": true,
			"password": "",
			"protected": false,
			"read_timecode": false
		},
		"user_variables": {
			
		},
		"desktop-uifqt86": {
			"work_folder": "d:\\.ffastrans_work_root\\20181202163733"
		},
		"farming": {
			"include": true,
			"list": ""
		},
		"avs_custom 20181208-105046-141-8facc6b99376": {
			"properties": {
				"description": "avisynth using mergergb function",
				"execute_on": 3800889,
				"outbounds": ["enc_av_xdcamhd 20181208-105419-306-480fe4ac70be"],
				"proc_x": 1089,
				"proc_y": 145,
				"template": "test",
				"x64avisynth": true
			}
		},
		"enc_av_xdcamhd 20181208-105419-306-480fe4ac70be": {
			"properties": {
				"aud_bits": 24,
				"audio_layout": "4x1",
				"avid_tape": "%s_original_path~1%",
				"avidclipname": "%s_original_name%",
				"avidenable": false,
				"avidproject": "%s_wf_name%",
				"db_adjust": -23,
				"description": "Just some example encoder that takes the output of avisynth script from the component before",
				"execute_on": 3800889,
				"format": "1920x1080i50",
				"interlacing": "Autodetect",
				"loudness_enable": false,
				"loudness_table": "",
				"outbounds": ["dest_folder 20181208-105430-425-56ec87f5dc49"],
				"proc_x": 1365,
				"proc_y": 145,
				"processing": "Full transcoding",
				"resizing": "Stretch and lose aspect",
				"start_tc": "%s_start_tc%",
				"type": "50 Mbit (422)",
				"wrapper": "MXF"
			}
		},
		"dest_folder 20181208-105430-425-56ec87f5dc49": {
			"properties": {
				"case": "None",
				"custom_node_name": "Deliver",
				"description": "copy the final result to output dir",
				"drop_ext": false,
				"drop_name": false,
				"execute_on": 3800889,
				"folder": "c:\\temp",
				"outbounds": [],
				"overwrite": false,
				"prefix": "",
				"proc_x": 1640,
				"proc_y": 145,
				"suffix": "",
				"unique": true
			}
		},
		"dec_avmedia 20181210-193825-135-15cac69d80e1": {
			"properties": {
				"a_decode": false,
				"a_method": "Intelligent",
				"audio": true,
				"description": "Decodes R picture, could be dumped by using r picture name in avisynth script ",
				"execute_on": 3800889,
				"force8bit": true,
				"outbounds": ["avs_custom 20181208-105046-141-8facc6b99376"],
				"proc_x": 814,
				"proc_y": 145,
				"v_decode": false,
				"v_method": "Intelligent",
				"video": true
			}
		},
		"op_populate 20181210-201110-785-8749f92a4f79": {
			"properties": {
				"custom_node_name": "Get IMG Names",
				"description": "caclulate B and G picture ndame from R picture name, input convention is *R.jpg",
				"execute_on": 3800889,
				"outbounds": ["dec_avmedia 20181210-193825-135-15cac69d80e1"],
				"proc_x": 538,
				"proc_y": 145,
				"variables_set": [{
					"name": "s_b_picture",
					"type": "string",
					"content": "$regext('%s_source%', '(.+?)R.jpg')"
				},
				{
					"name": "s_g_picture",
					"type": "string",
					"content": "$regext('%s_source%', '(.+?)R.jpg')"
				},
				{
					"name": "s_b_picture",
					"type": "string",
					"content": "%s_b_picture%B.jpg"
				},
				{
					"name": "s_g_picture",
					"type": "string",
					"content": "%s_g_picture%G.jpg"
				}]
			}
		},
		"mon_folder 20181210-203327-968-5281b631b556": {
			"properties": {
				"description": "Watchfolder\r\nd",
				"execute_on": 3800889,
				"outbounds": ["op_populate 20181210-201110-785-8749f92a4f79",
				"op_populate 20181216-091347-153-9e834df3ad4b"],
				"proc_x": 263,
				"proc_y": 145
			}
		},
		"op_populate 20181216-091347-153-9e834df3ad4b": {
			"properties": {
				"execute_on": 3800889,
				"outbounds": [],
				"proc_x": 538,
				"proc_y": 374,
				"variables_set": [{
					"name": "s_output_dir",
					"type": "string",
					"content": "test"
				}]
			}
		}
	}
    }//function
    
	</script>
</head>

<!-- Page passes the container for the graph to the program -->
<body onload="main(document.getElementById('graphContainer'))">

	<!-- Creates a container for the graph with a grid wallpaper -->
	<div id="graphContainer"
		style="position:relative;overflow:hidden;width:321px;height:241px;background:url('editors/images/grid.gif');cursor:default;">
	</div>
</body>
</html>
